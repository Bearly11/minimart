{% extends "master.html" %}
{% block main_content %}

<div class="container">

    <!-- Header -->
    <div class="d-flex align-items-center justify-content-between mb-3" style="padding-top: 12px">
        <h4 class="mb-0">Users</h4>
        <a href="{{ url_for('add_profile_form') }}" class="btn btn-primary">+ New Profile</a>
    </div>

    <!-- Search -->
    <form class="form-inline mb-3" method="get" action="{{ url_for('profile') }}">
        <input name="q" class="form-control mr-2" placeholder="Search username or email" value="{{ q or '' }}">
        <button class="btn btn-outline-secondary">Search</button>
        {% if q %}
            <a class="btn btn-link" href="{{ url_for('profile') }}">Clear</a>
        {% endif %}
    </form>

    <!-- User Table -->
    <div class="table-responsive">
        <table class="table table-striped table-hover align-middle">
            <thead class="thead-light">
            <tr>
                <th style="width:60px">ID</th>
                <th style="width:84px">Image</th>
                <th>Username</th>
                <th>Email</th>
                <th style="width:200px">Address</th>
                <th style="width:240px">Actions</th>
            </tr>
            </thead>
            <tbody>
            {% for u in profile %}
                <tr>
                    <td>{{ u.user_id }}</td>
                    <td>
                        {% if u.user_image %}
                            <img src="{{ url_for('static', filename='image/user_image/' ~ u.user_image) }}"
                                 style="width:72px;height:48px;object-fit:contain;background:#fff;border:1px solid #eee;border-radius:6px;padding:4px;">
                        {% else %}
                            <span class="text-muted">No Image</span>
                        {% endif %}
                    </td>
                    <td>{{ u.username }}</td>
                    <td>{{ u.email }}</td>
                    <td>{{ u.address or '-' }}</td>
                    <td>
                        <a href="{{ url_for('edit_profile_form', user_id=u.user_id) }}"
                           class="btn btn-sm btn-outline-primary">Edit</a>

                        <button class="btn btn-sm btn-outline-danger"
                                @click="confirmDelete({{ u.user_id }}, '{{ u.username }}')">
                            Delete
                        </button>
                        <button class="btn btn-sm btn-outline-warning"
                                @click="resetPassword({{ u.user_id }}, '{{ u.username }}')">
                            Reset Password
                        </button>
                    </td>
                </tr>
            {% else %}
                <tr>
                    <td colspan="6" class="text-center text-muted py-4">No users found.</td>
                </tr>
            {% endfor %}
            </tbody>
        </table>
    </div>
</div>

{% endblock %}
